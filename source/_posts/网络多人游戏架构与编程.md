---
title: 《网络多人游戏架构与编程》笔记
date: 2021-05-19 22:58:47
tags: 游戏开发
---

[百度云链接(提取码：8fv0)](https://pan.baidu.com/s/1Gl5K-v3rY23ZS5bXoIK4Lw)

![封面](/images/wangluoduorenyouxi.png)

<!--more -->

# 二、互联网

### 1. TCP/IP模型

* OSI(开放式系统互联)模型使用7层：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。
* TCP/IP模型：物理层，链路层，网络层，传输层，应用层。
* 每种物理介质，都有对应的协议或协议族来提供链路层所需的服务。

| 物理介质              | 链路层协议 |
| :----:                | :---: |
| 双绞线                | Ethernet 10BASET, 100BASET, 1000BASET (以太网) | 
| 双绞铜线              | Ethernet over copper (EoC) | 
| 2.4/5GHz无线电波      | 802.11b ... (短程无线网络协议) |
| 850MHz无线电波        | 3G, 4G （远程无限网络协议）|
| 光纤                  | 光纤分布式数据接口(FDDI), Ethernet 10GBASER, ... |
| 同轴电缆              | Ethernet over coax, ... |

### 2. 以太网

* 以太网(Ethernet)是以太网蓝皮书中的一组协议。它引入了介质访问控制地址（media access control address）的概念，也就是MAC地址。这个地址会烧到网卡之中，作为被寻址到的统一的唯一标识符。
* 以太网链路层帧格式，都包含**前导序列（preamble）**和**帧开始标志（start frame delimiter）**，包含十六进制值`0x55 0x55 0x55 0x55 0x55 0x55 0x55 0xD5`用来帮助底层硬件同步和准备接收到来的帧。
* 以太网的帧格式如下表所示：
    {% raw %}  
    <table border="1" cellspacing="0" bordercolor="#000000" width = "80%">
        <tr>
            <td> 0-7 </td>
            <th colspan="7"> 前导序列 </th>
            <td> 帧开始标志 </td>
        </tr>
        <tr>
            <td> 8-13 </td>
            <th colspan="6"> 目的地址 </th>
        </tr>
        <tr>
            <td> 14-21 </td>
            <th colspan="6"> 源地址 </th>
            <th colspan = "2"> 帧长度/类型域 </th>
        </tr>
        <tr>
            <td> 22-... </td>
            <th colspan="4"> 数据（46-1500字节） </th>
            <th colspan="4"> 帧检验序列 </th>
        </tr>
    </table>
    {% endraw %}
* MAC地址`FF:FF:FF:FF:FF:FF:`为广播地址，表示同时向局域网中的所有主机都发送该帧。
* 帧长度/类型域，共用这个字段。当表示帧类型时，就是**以太网类型（EtherType）**，标识解释数据的协议，当表示帧长度时，指定了帧中数据部分的字节数。
* 以太网标准规定帧内封装的报文数据最大长度为1500字节，称为最大传输单元(MTU)。还规定了以太网类型的最小值是`0x0600`。所以当上面的值小于等于1500就表示帧长度，大于等于1536就表示协议类型，通过协议类型和底层硬件配合，就可以传输高达9000字节的巨型帧。

### 3. 网路层

* 链路层的不足：
    * MAC地址烧在了硬件上，硬件炸了，其他的人都没法访问了。
    * 链路层需要进行物理连接，互相发送帧时没法进行隔离，没有区域划分的概念，不仅无法实现保护特定区域，并且网络数据压力贼大。
    * 链路层不支持使用不同的链路层协议进行主机之间的通信。也就是交换机收到数据之后，并没有办法把它转换成其他协议格式，比如通过无线电波传的。
* 现在实现网络层需求最常用的协议是互联网协议第四版（Internet protocol version 4, IPV4）
* 数据包结构见《秋招笔记》中计算机网路部分
* 在网络层，主机与主机之间是通过IP地址来互相通信的，网络层会将数据包交付给链路层进行实际的传输，链路层协议需要找到IP地址所对应的MAC地址，也就是**地址解析协议(address resolution protocol, ARP)**